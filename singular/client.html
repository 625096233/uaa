<!DOCTYPE html>
<html>
<head>
  <title>Client</title>

  <script type="application/javascript">
    var Singular = {
      properties: {
        onIdentityChange: function () { },
        clientId: "client",
        checkInterval: 1000,
        uaaLocation: 'http://localhost:8080/uaa',
        sessionFrameId: 'singularSessionFrame',
        clientFrameId: 'singularClientFrame',
        storageKey: 'singularUserIdentityClaims'
      },

      sessionFrame: null,

      init: function (params) {
        for (var p in params) {
          this.properties[p] = params[p];
        }

        this.sessionFrame = document.getElementById(this.properties.sessionFrameId);
        this.sessionFrame.src = this.properties.uaaLocation + "/session?clientId=" + this.properties.clientId + "&messageOrigin=" + encodeURIComponent(window.location.origin);

        var clientFrame = document.getElementById(this.properties.clientFrameId);
        clientFrame.src = "./client_frame.html";
      }
    };
  </script>

  <script type="application/javascript">
    window.onload = function () {
      Singular.init({

        clientId: "cf",

        onIdentityChange: function (identity) {
          if (identity) {
            console.log('User ' + identity.user_name + ' logged in');
            console.log(identity);
            document.getElementById('message').innerHTML = '<strong>' + identity.user_name + '</strong><br>logged in since ' + new Date(identity.auth_time*1000).toString();
          }
          else {
            console.log('User logged out');
            document.getElementById('message').innerHTML = 'Click <a href="' + Singular.properties.uaaLocation + '" target="_blank">here</a> to log in';
          }
        }

      });
    };
  </script>
</head>
<body>
<div id="message"></div>
<iframe id="singularSessionFrame" src="about:blank" style="visibility: hidden"></iframe>
<iframe id="singularClientFrame" src="about:blank" style="visibility: hidden"></iframe>
</body>
</html>
